# 水印图片处理应用 - 技术选型与架构设计

## 1. 技术选型

### 1.1 前端技术
- **框架**：Vue.js 3.x
- **UI组件库**：Element Plus
- **状态管理**：Vuex
- **路由管理**：Vue Router
- **图片预览与处理**：使用原生Canvas API或第三方库（如 fabric.js）
- **打包工具**：Vite
- **样式**：Sass/SCSS

### 1.2 后端技术
- **语言**：Java 17+
- **框架**：Spring Boot 3.x
- **图片处理**：Java原生BufferedImage、ImageIO，必要时引入第三方库（如 Thumbnailator、TwelveMonkeys ImageIO扩展）
- **本地数据存储**：SQLite（嵌入式数据库，生成本地.db文件，无需外部服务器）
- **接口通信**：RESTful API（JSON），实时预览采用WebSocket
- **日志与监控**：SLF4J + Logback
- **文件管理**：Java NIO（本地文件系统操作）

### 1.3 其他工具与依赖
- **依赖管理**：Maven
- **测试框架**：JUnit 5、Mockito
- **代码质量**：Checkstyle、SpotBugs
- **打包分发**：JavaFX/Exe4j（可选，打包为Windows桌面应用）

## 2. 系统架构设计

### 2.1 总体架构

```
┌─────────────┐    HTTP API/WebSocket   ┌─────────────┐
│   Vue前端   │ <--------------------> │   Java后端  │
└─────────────┘                        └─────────────┘
         │                                    │
         ▼                                    ▼
   用户本地文件系统                    本地SQLite数据库文件
   (原图片/水印图片)                   (config.db - 存储模板和配置)
```

### 2.2 本地存储说明

**SQLite嵌入式数据库**：
- 无需安装数据库服务器，SQLite直接嵌入到Java应用中
- 在应用目录下生成一个 `watermark_app.db` 文件
- 存储内容：水印模板、用户配置、处理历史记录
- 文件位置：`%APPDATA%\WatermarkApp\watermark_app.db`

**文件系统存储**：
- 原始图片：用户选择的文件路径（只读）
- 缩略图缓存：`%APPDATA%\WatermarkApp\thumbnails\`
- 导出图片：用户指定的输出目录
- 临时预览图：系统临时目录，应用关闭时清理

### 2.2 前端模块划分
- **图片导入与列表组件**
- **主预览组件**
- **水印配置面板组件**
- **输出设置组件**
- **模板管理组件**
- **全局状态管理（Vuex）**

### 2.3 后端模块划分
- **Controller层**：API接口（图片导入、处理、导出、模板管理）
- **Service层**：业务逻辑（水印处理、批量处理、预览生成）
- **Strategy模式**：水印类型处理（文本/图片）
- **Factory模式**：图片处理器创建
- **Builder模式**：水印参数构建
- **Repository层**：配置与模板持久化
- **Observer模式**：处理进度通知

### 2.4 关键第三方库
- **前端**：
  - Element Plus（UI）
  - fabric.js（可选，图片编辑/拖拽/旋转）
- **后端**：
  - Thumbnailator（图片缩放/格式转换）
  - TwelveMonkeys ImageIO（TIFF/BMP等格式支持）
  - SQLite JDBC（本地数据库）

### 2.5 通信协议
- **图片列表/预览/处理/导出/模板管理**均采用RESTful API（JSON数据）
- **实时预览**采用WebSocket推送预览结果

### 2.6 部署与运行
- **本地运行**：Java后端以Spring Boot服务形式运行，前端Vue项目本地打包后通过Electron或JavaFX集成为桌面应用
- **数据存储**：所有图片和模板均存储于用户本地，无云端依赖

## 3. 关键架构图

### 3.1 模块交互流程
```
[用户操作] → [Vue前端] → [REST API/WebSocket] → [Java后端] → [图片处理/模板管理] → [结果返回前端]
```

### 3.2 典型用例流程
- **批量导入图片**：前端选择/拖拽 → API上传文件路径 → 后端解析生成缩略图 → 返回图片列表
- **水印配置调整**：前端配置参数 → WebSocket实时推送 → 后端生成预览 → 返回预览图
- **批量导出图片**：前端发起导出请求 → 后端批量处理 → 进度通知 → 结果返回
- **模板保存/加载**：前端发起请求 → 后端持久化/读取 → 返回模板参数

## 4. 设计原则
- **单一职责**：每个模块只负责一种功能，易于维护和扩展
- **高内聚低耦合**：前后端分离，接口清晰
- **可扩展性**：水印类型、图片格式、模板等均可扩展
- **易用性**：界面友好，交互流畅
- **安全性**：本地文件安全，防止数据丢失和覆盖

---

**文档版本**: v1.0  
**创建日期**: 2025-09-28  
**最后更新**: 2025-09-28