# 水印图片处理应用 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品描述
本产品是一款基于Windows平台的本地水印图片处理应用，支持批量图片导入、实时水印预览、多种水印类型和灵活的输出配置。采用Vue.js前端界面和Java后端处理架构，确保良好的用户体验和高性能的图片处理能力。

### 1.2 技术架构
- **前端**: Vue.js 3.x + Element Plus UI框架
- **后端**: Java 17+ (Spring Boot框架)
- **图片处理**: Java BufferedImage + ImageIO
- **数据存储**: SQLite (本地配置和模板存储)
- **通信方式**: RESTful API / WebSocket (实时预览)

### 1.3 目标用户
- 摄影师和设计师
- 内容创作者
- 需要批量处理图片水印的企业用户
- 个人用户

## 2. 功能需求

### 2.1 文件处理模块

#### 2.1.1 图片导入功能 (优先级: 高)
**需求描述**: 支持多种方式导入图片文件

**功能点**:
- 单张图片拖拽导入
- 文件选择器单选/多选导入
- 整个文件夹批量导入
- 导入图片列表显示（缩略图150x150px + 文件名）
- 支持图片预览和删除

**接受标准**:
- 支持拖拽区域高亮显示
- 导入进度条显示
- 错误文件过滤并提示
- 缩略图加载性能良好

#### 2.1.2 支持格式 (优先级: 高)
**输入格式**:
- 必须支持: JPEG (.jpg, .jpeg), PNG (.png)
- 强烈建议: BMP (.bmp), TIFF (.tif, .tiff)
- PNG格式必须完整支持透明通道

**输出格式**:
- JPEG (可调节质量 0-100%)
- PNG (保持透明通道)

#### 2.1.3 导出功能 (优先级: 高)
**基础功能**:
- 用户指定输出文件夹
- 默认禁止导出到原文件夹（安全机制）
- 文件命名规则选项:
  - 保留原文件名
  - 添加自定义前缀 (默认: "wm_")
  - 添加自定义后缀 (默认: "_watermarked")

**高级功能** (优先级: 中):
- JPEG质量调节滑块 (0-100%)
- 图片尺寸调整:
  - 按宽度缩放
  - 按高度缩放
  - 按百分比缩放
  - 保持宽高比选项

### 2.2 水印类型模块

#### 2.2.1 文本水印 (优先级: 高)
**基础功能**:
- 自定义文本内容输入
- 透明度调节 (0-100%)
- 颜色选择器

**高级功能** (优先级: 中):
- 字体选择 (系统字体)
- 字号调节 (12-200px)
- 字体样式 (粗体、斜体)
- 阴影效果 (颜色、偏移、模糊度)
- 描边效果 (颜色、宽度)

#### 2.2.2 图片水印 (优先级: 中)
**功能点**:
- 本地图片选择作为水印
- 支持带透明通道的PNG
- 等比例/自由缩放
- 透明度调节 (0-100%)

### 2.3 水印布局与样式模块

#### 2.3.1 实时预览 (优先级: 高)
**功能点**:
- 主预览窗口实时显示水印效果
- 点击图片列表切换预览
- 预览区域支持缩放和平移
- 预览性能优化 (缩略图预览 + 原图处理)

#### 2.3.2 位置控制 (优先级: 高)
**预设位置** (九宫格):
```
左上    上中    右上
左中    正中    右中  
左下    下中    右下
```

**交互方式**:
- 九宫格按钮快速定位
- 鼠标拖拽精确定位
- 数值输入 (X, Y坐标)

#### 2.3.3 旋转功能 (优先级: 中)
- 旋转角度滑块 (-180° 到 +180°)
- 数值输入框
- 实时预览旋转效果

### 2.4 配置管理模块

#### 2.4.1 水印模板 (优先级: 中)
**功能点**:
- 保存当前水印配置为模板
- 模板命名和描述
- 模板列表管理 (加载、重命名、删除)
- 默认模板设置
- 程序启动时自动加载上次配置

**模板包含参数**:
- 水印类型 (文本/图片)
- 文本内容和样式
- 图片路径和设置
- 位置和旋转角度
- 透明度和其他效果参数

## 3. 非功能需求

### 3.1 性能需求
- 图片预览响应时间 < 500ms
- 批量处理支持 1000+ 图片
- 内存占用优化 (大图片流式处理)
- UI响应时间 < 100ms

### 3.2 兼容性需求
- Windows 10/11 操作系统
- 最低4GB内存推荐
- 支持高DPI显示器
- Java 17+ 运行环境

### 3.3 安全性需求
- 本地文件访问权限控制
- 防止覆盖原始文件
- 异常处理和错误恢复
- 用户数据本地存储

## 4. 用户界面设计

### 4.1 主界面布局
```
┌─────────────────────────────────────────────────────────┐
│  File  Edit  View  Tools  Help                         │
├─────────────────────────────────────────────────────────┤
│ [导入图片] [批量导入] [清空列表]    [保存模板] [加载模板] │
├──────────────────────┬──────────────────────────────────┤
│                      │                                  │
│    图片列表区域        │         预览区域                  │
│   (缩略图 + 文件名)     │    (实时水印效果预览)              │
│                      │                                  │
│                      │                                  │
├──────────────────────┴──────────────────────────────────┤
│                   水印配置面板                            │
│ [文本水印] [图片水印]  位置控制  样式设置  透明度等          │
├─────────────────────────────────────────────────────────┤
│ [输出设置] [开始处理] [进度条]                            │
└─────────────────────────────────────────────────────────┘
```

### 4.2 关键交互
- 拖拽区域醒目提示
- 实时预览更新
- 进度反馈和状态提示
- 错误信息友好展示

## 5. 技术实现要点

### 5.1 Java后端设计模式应用

#### 5.1.1 核心设计模式
1. **策略模式**: 不同水印类型处理策略
   ```java
   interface WatermarkStrategy {
       BufferedImage applyWatermark(BufferedImage image, WatermarkConfig config);
   }
   ```

2. **建造者模式**: 复杂水印配置构建
   ```java
   class WatermarkConfig.Builder {
       // 链式配置构建
   }
   ```

3. **工厂模式**: 图片处理器创建
   ```java
   class ImageProcessorFactory {
       static ImageProcessor create(String format);
   }
   ```

4. **模板方法模式**: 图片处理流程
   ```java
   abstract class ImageProcessor {
       final BufferedImage process(BufferedImage input);
   }
   ```

5. **观察者模式**: 处理进度通知
   ```java
   interface ProcessingObserver {
       void onProgress(int percentage);
   }
   ```

#### 5.1.2 关键类设计
- `WatermarkService`: 核心业务服务
- `ImageIOManager`: 图片读写管理
- `ConfigurationManager`: 配置和模板管理  
- `PreviewGenerator`: 预览图生成
- `BatchProcessor`: 批量处理引擎

### 5.2 Vue前端架构
- 组件化设计 (图片列表、预览区、配置面板)
- Vuex状态管理
- 组件通信 (EventBus/Props/Emit)
- 响应式布局

## 6. 开发计划

### 阶段一: 核心功能 (优先级: 高)
- [ ] 图片导入和列表显示
- [ ] 基础文本水印功能
- [ ] 实时预览
- [ ] 基础导出功能

### 阶段二: 增强功能 (优先级: 中)  
- [ ] 图片水印
- [ ] 高级文本样式
- [ ] 位置拖拽和旋转
- [ ] 模板管理

### 阶段三: 高级功能 (优先级: 低)
- [ ] 图片尺寸调整
- [ ] 质量控制
- [ ] 批量处理优化
- [ ] UI美化和动画

## 7. 验收标准

### 7.1 功能验收
- 所有核心功能正常工作
- 支持的图片格式完全兼容
- 水印效果与预览一致
- 批量处理稳定可靠

### 7.2 性能验收  
- 1000张图片批量处理完成时间 < 10分钟
- 预览响应时间满足要求
- 内存使用合理 (< 2GB for 1000 images)

### 7.3 用户体验验收
- 界面友好直观
- 操作流程顺畅
- 错误处理完善
- 帮助文档完整

---

**文档版本**: v1.0  
**创建日期**: 2025-09-28  
**最后更新**: 2025-09-28